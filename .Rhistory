})
# Update Info Button
observeEvent(input$update_info_btn, {
showNotification("Click on a row in the table below to select a patient for updating.", type = "message")
})
# --- Module Calls ---
patientFormServer("form1", rv_refresh, current_staff)
patientMapServer("map1", get_data)
# Logout
observeEvent(input$logout_btn, { session$reload() })
}
server <- function(input, output, session) {
vals <- reactiveValues(logged_in = FALSE)
rv_refresh <- reactiveValues(trigger = 0)
# Reactive to store logged-in user
current_staff <- reactive({ input$user })
# --- Login Logic ---
showModal(modalDialog(
title = "Staff Login",
textInput("user", "Username:"),
passwordInput("pass", "Password"),
footer = actionButton("login_btn", "Login", class = "btn-red"),
size = "s", easyClose = FALSE
))
observeEvent(input$login_btn, {
conn <- create_connection(); req(conn)
res <- get_user_by_credentials(conn, input$user, input$pass)
dbDisconnect(conn)
if (nrow(res) > 0) {
vals$logged_in <- TRUE; removeModal()
} else {
showNotification("Invalid Credentials", type = "error")
}
})
# --- UI Rendering (Restored Original Layout) ---
output$authenticated_ui <- renderUI({
req(vals$logged_in)
tagList(
div(class = "red-header", "Patient Record System",
div(style = "float: right; font-size: 14px;",
span(icon("user-md"), paste(" Welcome, ", current_staff())),
actionButton("logout_btn", "Logout", class = "btn-gray", style = "margin-left:10px;"))),
navbarPage(title = NULL,
tabPanel("Records", icon = icon("database"),
wellPanel(style = "background-color: #FDECEC;", # Restored original light red bg
fluidRow(
column(3, textInput("search_name", label = tags$b("Search Patient Name:"), value = "")),
column(9, div(style = "margin-top: 25px;",
# Restored full button set with original icons and classes
actionButton("add_visit_btn", "Add New Visit", class = "btn-red", icon = icon("user-plus")),
actionButton("update_info_btn", "Update Patient Info", class = "btn-gray", icon = icon("edit")),
actionButton("view_all_btn", "View All Records", class = "btn-gray", icon = icon("sync-alt")),
actionButton("clear_search_btn", "Clear Search", class = "btn-gray", icon = icon("eraser"))
))
)
),
div(class = "data-section",
tags$h4("Patient Records (Sorted by Latest Visit)"),
DTOutput("patient_table")
)
),
tabPanel("Locator", icon = icon("map-marked-alt"), patientMapUI("map1"))
)
)
})
# --- Data Logic ---
get_data <- reactive({
req(vals$logged_in); rv_refresh$trigger
search_term <- if (is.null(input$search_name) || input$search_name == "") "" else input$search_name
conn <- create_connection(); req(conn)
data <- tryCatch({ get_patients(conn, search_term) }, error = function(e) { return(data.frame()) })
dbDisconnect(conn)
data
})
# --- Table Output (Fixed Alignment & Removed Pagination if desired) ---
output$patient_table <- renderDT(get_data(), selection = "single",
options = list(
pageLength = -1, # Shows ALL records to match original Tcl/Tk feel
dom = 't',       # Only show the table (removes search/length/paging)
scrollX = TRUE,
autoWidth = FALSE, # Set to FALSE to prevent column misalignment
columnDefs = list(list(className = 'dt-center', targets = "_all")) # Center all text
)
)
# --- Event Handlers ---
# Add Visit
observeEvent(input$add_visit_btn, {
conn <- create_connection(); plist <- get_patient_list(conn); dbDisconnect(conn)
showModal(modalDialog(title = "Add Visit", patientFormUI("form1"), size = "m"))
updateSelectizeInput(session, "form1-select_patient", server = TRUE,
choices = setNames(plist$patient_id, plist$patient_name))
})
# Clear Search Button
observeEvent(input$clear_search_btn, {
updateTextInput(session, "search_name", value = "")
rv_refresh$trigger <- rv_refresh$trigger + 1
})
# View All Button
observeEvent(input$view_all_btn, {
updateTextInput(session, "search_name", value = "")
rv_refresh$trigger <- rv_refresh$trigger + 1
})
# Update Info Button (Placeholder for your update logic)
observeEvent(input$update_info_btn, {
showNotification("Click on a row in the table below to select a patient for updating.", type = "message")
})
# --- Module Calls ---
patientFormServer("form1", rv_refresh, current_staff)
patientMapServer("map1", get_data)
# Logout
observeEvent(input$logout_btn, { session$reload() })
}
server <- function(input, output, session) {
vals <- reactiveValues(logged_in = FALSE)
rv_refresh <- reactiveValues(trigger = 0)
# Reactive to store logged-in user
current_staff <- reactive({ input$user })
# --- Login Logic ---
showModal(modalDialog(
title = "Staff Login",
textInput("user", "Username:"),
passwordInput("pass", "Password"),
footer = actionButton("login_btn", "Login", class = "btn-red"),
size = "s", easyClose = FALSE
))
observeEvent(input$login_btn, {
conn <- create_connection(); req(conn)
res <- get_user_by_credentials(conn, input$user, input$pass)
dbDisconnect(conn)
if (nrow(res) > 0) {
vals$logged_in <- TRUE; removeModal()
} else {
showNotification("Invalid Credentials", type = "error")
}
})
# --- UI Rendering (Restored Original Layout) ---
output$authenticated_ui <- renderUI({
req(vals$logged_in)
tagList(
div(class = "red-header", "Patient Record System",
div(style = "float: right; font-size: 14px;",
span(icon("user-md"), paste(" Welcome, ", current_staff())),
actionButton("logout_btn", "Logout", class = "btn-gray", style = "margin-left:10px;"))),
navbarPage(title = NULL,
tabPanel("Records", icon = icon("database"),
wellPanel(style = "background-color: #FDECEC;", # Restored original light red bg
fluidRow(
column(3, textInput("search_name", label = tags$b("Search Patient Name:"), value = "")),
column(9, div(style = "margin-top: 25px;",
# Restored full button set with original icons and classes
actionButton("add_visit_btn", "Add New Visit", class = "btn-red", icon = icon("user-plus")),
actionButton("update_info_btn", "Update Patient Info", class = "btn-gray", icon = icon("edit")),
actionButton("view_all_btn", "View All Records", class = "btn-gray", icon = icon("sync-alt")),
actionButton("clear_search_btn", "Clear Search", class = "btn-gray", icon = icon("eraser"))
))
)
),
div(class = "data-section",
tags$h4("Patient Records (Sorted by Latest Visit)"),
DTOutput("patient_table")
)
),
tabPanel("Locator", icon = icon("map-marked-alt"), patientMapUI("map1"))
)
)
})
# --- Data Logic ---
get_data <- reactive({
req(vals$logged_in); rv_refresh$trigger
search_term <- if (is.null(input$search_name) || input$search_name == "") "" else input$search_name
conn <- create_connection(); req(conn)
data <- tryCatch({ get_patients(conn, search_term) }, error = function(e) { return(data.frame()) })
dbDisconnect(conn)
data
})
# --- Table Output (Fixed Alignment & Removed Pagination if desired) ---
output$patient_table <- renderDT(get_data(), selection = "single",
options = list(
pageLength = -1, # Shows ALL records to match original Tcl/Tk feel
dom = 't',       # Only show the table (removes search/length/paging)
scrollX = TRUE,
autoWidth = FALSE, # Set to FALSE to prevent column misalignment
columnDefs = list(list(className = 'dt-center', targets = "_all")) # Center all text
)
)
# --- Event Handlers ---
# Add Visit
observeEvent(input$add_visit_btn, {
conn <- create_connection(); plist <- get_patient_list(conn); dbDisconnect(conn)
showModal(modalDialog(title = "Add Visit", patientFormUI("form1"), size = "m"))
updateSelectizeInput(session, "form1-select_patient", server = TRUE,
choices = setNames(plist$patient_id, plist$patient_name))
})
# Clear Search Button
observeEvent(input$clear_search_btn, {
updateTextInput(session, "search_name", value = "")
rv_refresh$trigger <- rv_refresh$trigger + 1
})
# View All Button
observeEvent(input$view_all_btn, {
updateTextInput(session, "search_name", value = "")
rv_refresh$trigger <- rv_refresh$trigger + 1
})
# Update Info Button (Placeholder for your update logic)
observeEvent(input$update_info_btn, {
showNotification("Click on a row in the table below to select a patient for updating.", type = "message")
})
# --- Module Calls ---
patientFormServer("form1", rv_refresh, current_staff)
patientMapServer("map1", get_data)
# Logout
observeEvent(input$logout_btn, { session$reload() })
}
source("C:/Users/Joseph Solomo/OneDrive/Desktop/JOSEPH/ELEC4/FINAL PROJECT/patient-record-system/server/server_main.R", echo = TRUE)
server <- function(input, output, session) {
vals <- reactiveValues(logged_in = FALSE)
rv_refresh <- reactiveValues(trigger = 0)
# Reactive to store logged-in user
current_staff <- reactive({ input$user })
# --- Login Logic ---
showModal(modalDialog(
title = "Staff Login",
textInput("user", "Username:"),
passwordInput("pass", "Password"),
footer = actionButton("login_btn", "Login", class = "btn-red"),
size = "s", easyClose = FALSE
))
observeEvent(input$login_btn, {
conn <- create_connection(); req(conn)
res <- get_user_by_credentials(conn, input$user, input$pass)
dbDisconnect(conn)
if (nrow(res) > 0) {
vals$logged_in <- TRUE; removeModal()
} else {
showNotification("Invalid Credentials", type = "error")
}
})
# --- UI Rendering ---
output$authenticated_ui <- renderUI({
req(vals$logged_in)
tagList(
# Custom CSS to make pagination buttons match your 'btn-red' theme
tags$style(HTML("
.dataTables_wrapper .dataTables_paginate .paginate_button.current {
background: #d9534f !important; border: 1px solid #d43f3a !important; color: white !important;
}
.dataTables_wrapper .dataTables_paginate .paginate_button:hover {
background: #c9302c !important; color: white !important; border: 1px solid #ac2925 !important;
}
")),
div(class = "red-header", "Patient Record System",
div(style = "float: right; font-size: 14px;",
span(icon("user-md"), paste(" Welcome, ", current_staff())),
actionButton("logout_btn", "Logout", class = "btn-gray", style = "margin-left:10px;"))),
navbarPage(title = NULL,
tabPanel("Records", icon = icon("database"),
wellPanel(style = "background-color: #FDECEC;",
fluidRow(
column(3, textInput("search_name", label = tags$b("Search Patient Name:"), value = "")),
column(9, div(style = "margin-top: 25px;",
actionButton("add_visit_btn", "Add New Visit", class = "btn-red", icon = icon("user-plus")),
actionButton("update_info_btn", "Update Patient Info", class = "btn-gray", icon = icon("edit")),
actionButton("view_all_btn", "View All Records", class = "btn-gray", icon = icon("sync-alt")),
actionButton("clear_search_btn", "Clear Search", class = "btn-gray", icon = icon("eraser"))
))
)
),
div(class = "data-section",
tags$h4("Patient Records (Sorted by Latest Visit)"),
DTOutput("patient_table")
)
),
tabPanel("Locator", icon = icon("map-marked-alt"), patientMapUI("map1"))
)
)
})
# --- Data Logic ---
get_data <- reactive({
req(vals$logged_in); rv_refresh$trigger
search_term <- if (is.null(input$search_name) || input$search_name == "") "" else input$search_name
conn <- create_connection(); req(conn)
data <- tryCatch({ get_patients(conn, search_term) }, error = function(e) { return(data.frame()) })
dbDisconnect(conn)
data
})
# --- Table Output (Modified for Pagination) ---
output$patient_table <- renderDT(get_data(), selection = "single",
options = list(
pageLength = 10,      # Show exactly 10 records per page
lengthChange = FALSE, # Prevent user from changing the 10-row limit
dom = 'tp',           # 't' for table, 'p' for pagination navigation
scrollX = TRUE,
autoWidth = FALSE,
columnDefs = list(list(className = 'dt-center', targets = "_all"))
)
)
# --- Event Handlers ---
# Add Visit
observeEvent(input$add_visit_btn, {
conn <- create_connection(); plist <- get_patient_list(conn); dbDisconnect(conn)
showModal(modalDialog(title = "Add Visit", patientFormUI("form1"), size = "m"))
updateSelectizeInput(session, "form1-select_patient", server = TRUE,
choices = setNames(plist$patient_id, plist$patient_name))
})
# Clear Search Button
observeEvent(input$clear_search_btn, {
updateTextInput(session, "search_name", value = "")
rv_refresh$trigger <- rv_refresh$trigger + 1
})
# View All Button
observeEvent(input$view_all_btn, {
updateTextInput(session, "search_name", value = "")
rv_refresh$trigger <- rv_refresh$trigger + 1
})
# Update Info Button
observeEvent(input$update_info_btn, {
showNotification("Click on a row in the table below to select a patient for updating.", type = "message")
})
# --- Module Calls ---
patientFormServer("form1", rv_refresh, current_staff)
patientMapServer("map1", get_data)
# Logout
observeEvent(input$logout_btn, { session$reload() })
}
shiny::runApp()
shiny::runApp()
shiny::runApp()
-- This adds the missing column and sets all existing records to TRUE (Active)
# Run this in your R console to fix the database structure
conn <- create_connection()
dbExecute(conn, "ALTER TABLE patients ADD COLUMN is_active BOOLEAN DEFAULT TRUE;")
dbDisconnect(conn)
runApp()
shiny::runApp()
runApp()
shiny::runApp()
shiny::runApp()
runApp()
runApp()
runApp()
shiny::runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
shiny::runApp()
runApp()
runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
runApp()
install.packages("plotly")
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
runApp()
runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
runApp()
runApp()
runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
load("C:/Users/Joseph Solomo/OneDrive/Desktop/JOSEPH/ELEC4/FINAL PROJECT/patient-record-system/.RData")
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
tagList(
tags$style(HTML(".dataTables_wrapper .dataTables_paginate .paginate_button.current { background: #B71C1C !important; color: white !important; }")),
div(class = "red-header", "Patient Record System",
div(style = "float: right; font-size: 14px;",
span(icon("user-md"), paste(" Welcome, ", current_staff())),
actionButton("logout_btn", "Logout", class = "btn-gray", style = "margin-left:10px;"))),
navbarPage(title = NULL,
tabPanel("Records", icon = icon("database"),
wellPanel(style = "background-color: #FDECEC;",
fluidRow(
column(3, textInput("search_name", label = tags$b("Search Patient Name:"), value = "")),
column(9, div(style = "margin-top: 25px;",
actionButton("add_visit_btn", "Add Patient Visit", class = "btn-red", icon = icon("user-plus")),
actionButton("view_archive_btn", "Restore Records", class = "btn-gray", icon = icon("history")),
shinyjs::disabled(actionButton("view_record_btn", "View Record", class = "btn-gray", icon = icon("id-card"))),
actionButton("clear_search_btn", "Clear Search", class = "btn-gray", icon = icon("eraser"))))
)),
div(class = "data-section", tags$h4("patient$`Patient Name`"), DTOutput("patient_table"))
),
tabPanel("Locator", icon = icon("map-marked-alt"), patientMapUI("map1"))
)
)
Patient Records
showModal(modalDialog(
title = span(paste("Patient Record -", patient$`Patient Name`), style = "color: #B71C1C; font-weight: bold;"),
size = "l", easyClose = TRUE,
footer = tagList(
actionButton("archive_record_btn", "Archive Record", class = "btn-gray", icon = icon("trash-alt"), style="float: left;"),
actionButton("edit_record_internal_btn", "Edit Info", class = "btn-red", icon = icon("edit")),
modalButton("Close")
),
fluidRow(
column(4, div(style="text-align: center; border: 2px solid #B71C1C; padding: 15px; border-radius: 15px; background: #fff;",
icon("user-circle", style="font-size: 80px; color: #B71C1C;"),
h4(patient$`Patient Name`, style="margin-top:10px;"),
span(style="font-weight: bold; color: #B71C1C;", paste("ID:", patient$ID)),
hr(),
tags$b(icon("history"), " Patient History"),
div(style="max-height: 300px; overflow-y: auto; margin-top: 10px; font-size: 10px; text-align: left;",
if(nrow(history_data) > 0) {
renderTable({
display_history <- history_data
# Fixed Date formatting and integrated staff alignment
display_history$Date <- format(as.Date(display_history$Date), "%Y-%m-%d")
display_history
}, striped = TRUE, hover = TRUE, width = "100%", align = "l")
} else {
p("No previous records found.", style="color: #757575; padding: 10px;")
}
)
)),
column(8, div(class="well", style="background: white; border-top: 4px solid #B71C1C; min-height: 450px;",
h4("Patient Profile", style="color:#B71C1C; font-weight: bold;"), hr(),
fluidRow(
column(6, p(strong("Birthday:"), patient$Birthday), p(strong("Gender:"), patient$Gender), p(strong("Contact:"), patient$`Contact No.`)),
column(6, p(strong("Most Recent Visit:"), patient$`Visit Date`))
),
hr(), p(strong("Complete Address:")),
div(style="padding: 10px; border-left: 3px solid #B71C1C; margin-bottom: 10px;", p(patient$complete_address)),
hr(), h5(strong("Latest Diagnosis:")),
div(style="padding: 20px; background: #FDECEC; border-radius: 8px;", p(patient$Diagnosis))))
)
))
# --- 6. Patient Management ---
observeEvent(input$edit_record_internal_btn, {
removeModal(); selected_row <- input$patient_table_rows_selected; patient <- get_data()[selected_row, ]
showModal(modalDialog(
title = paste("Modify", patient$`Patient Name`), patientFormUI("form_update", is_updating = TRUE),
footer = tagList(modalButton("Cancel"), actionButton("form_update-save_visit_all", "Save Changes", class = "btn-red"))
))
updateTextInput(session, "form_update-new_patient_name", value = patient$`Patient Name`)
updateDateInput(session, "form_update-new_dob", value = as.Date(patient$`Birthday`))
updateTextInput(session, "form_update-new_phone", value = patient$`Contact No.`)
updateTextAreaInput(session, "form_update-complaint", value = patient$Diagnosis)
updateTextInput(session, "form_update-addr_details", value = patient$complete_address)
updateSelectInput(session, "form_update-purok", selected = patient$Area)
})
observeEvent(input$archive_record_btn, {
pid <- clean_custom_id(get_data()$ID[input$patient_table_rows_selected]); conn <- create_connection()
archive_patient(conn, pid); dbDisconnect(conn); removeModal(); rv_refresh$trigger <- rv_refresh$trigger + 1
})
shiny::runApp()
shiny::runApp()
shiny::runApp()
runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
git init
